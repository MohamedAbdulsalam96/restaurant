<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu</title>
    <style>
        /* CSS styles go here */

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f2f2f2;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .menu {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px
        }

        .menu-item {
            width: calc(20% - 20px);
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            background-color: #fff;
            transition: transform 0.2s;
        }

        .menu-item img {
            min-width: 100%;
            height: 250px;
        }

        .menu-item-content {
            padding: 20px;
            text-align: center;
        }

        .menu-item h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }

        .menu-item p {
            margin-bottom: 10px;
            color: #666;
        }

        .menu-item .price {
            font-weight: bold;
            color: #ff5733;
        }

        .add-to-cart-btn {
            background-color: #2490EF;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-top: 10px;
            cursor: pointer;
        }

        .cart {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 80%;
            overflow-y: auto;
            display: none;
        }

        .cart h2 {
            font-size: 1.5rem;
            color: #333;
        }

        .cart-items {
            list-style-type: none;
            padding: 0;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-name {
            flex-grow: 1;
        }

        .cart-item-total {
            font-weight: bold;
            color: #ff5733;
        }

        .checkout-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-top: 20px;
            cursor: pointer;
        }

        .modal {

            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-width: 800px;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Responsive design */
        @media screen and (max-width: 768px) {
            .menu-item {
                width: calc(50% - 20px);
            }
        }

        @media screen and (max-width: 480px) {
            .menu-item {
                width: 100%;
            }
        }


        .filter-container {
            text-align: left;
            margin-top: 20px;
        }

        .filter-button {
            background-color: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .filter-button:hover {
            background-color: #555;
        }

        .search-container {
            text-align: left;
            margin-top: 20px;
        }
        .table-container {
            text-align: left;
            margin-top: 20px;
        }

        .search-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            max-width: 1200px;
        }
        .table-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
            max-width: 300px;
        }

        .floating-cart-btn {
            background-color: #4CAF50;
            color: black;
            border: none;
            border-radius: 50%;
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            text-align: center;
        }
        /*TEEEEEEEEEEEEEEST*/
        #custom-alert {
            flex-direction: row;
          display: none;
          position: fixed;
          top: 94%;
            font-weight: bold;
          right: -10px;
          transform: translate(-50%, -50%);
          /*background-color: #00c853;*/
          background-color: white;
          padding: 0 5px 5px 10px;
            width: 200px;
          border: 1px solid #ccc;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        #custom-alert1 {
            flex-direction: row;
          display: none;
          position: fixed;
          top: 94%;
            font-weight: bold;
          right: -10px;
          transform: translate(-50%, -50%);
          /*background-color: #00c853;*/
          background-color: white;
          padding: 0 5px 5px 10px;
            width: 200px;
          border: 1px solid #ccc;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        #custom-alert2 {
            flex-direction: row;
          display: none;
          position: fixed;
          top: 94%;
            font-weight: bold;
          right: -10px;
          transform: translate(-50%, -50%);
          /*background-color: #00c853;*/
          background-color: white;
          padding: 0 5px 5px 10px;
            width: 200px;
          border: 1px solid #ccc;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .modal1 {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Places the modal above other elements */
        }
        /* Styles for the modal content */
        .modal-content1 {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
            padding: 20px;
            text-align: center;
        }
        /* Button styles */
        .modal-button1 {
            margin: 10px;
            padding: 10px 20px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .quantity-modal {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
            padding: 10px;
            text-align: center;
            transform: translate(25%, 25%);
        }
         .quantity-input {
            width: 40px;
            text-align: center;
        }
         .quantity-arrows {
            cursor: pointer;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Restaurant Menu</h1>
        <div class="table-container">
            <input type="text" class="table-input" placeholder="Table" id="table" readonly/>
        </div>
        <div class="filter-container">
            <button class="filter-button" data-category="all">All</button>
            <button class="filter-button" data-category="appetizers">Appetizers</button>
            <button class="filter-button" data-category="main-courses">Main Courses</button>
            <button class="filter-button" data-category="desserts">Desserts</button>
            <button class="filter-button" data-category="drinks">Drinks</button>
            <!-- Add more categories as needed -->
        </div>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search menu items" id="searchInput">
        </div>

        <div class="menu" id="menuContainer">
            <!-- Menu items with "Add to Cart" buttons here -->
            <!-- Example item:
            <div class="menu-item" data-category="appetizers">
                <img src="item-image.jpg" alt="Item Name">
                <div class="menu-item-content">
                    <h3>Item Name</h3>
                    <p>Description of the item. Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
                    <p class="price">$9.99</p>
                    <button class="add-to-cart-btn" data-index="0">Add to Cart</button>
                </div>
            </div>
            -->
        </div>
    </div>

    <div class="floating-cart-btn" id="openCartBtn"><span style="margin-top: 30px">&#128722;</span></div>

    <div class="cart" id="cart">
        <h2>Your Cart</h2>
        <ul class="cart-items" id="cartItems">
            <!-- Cart items will be dynamically added here -->
        </ul>
        <p>Total: <span class="cart-item-total" id="cartTotal">$0.00</span></p>
        <button class="checkout-btn" id="checkoutBtn">Checkout</button>
    </div>

    <div class="modal" id="cartModal">
        <div class="modal-content">
            <span class="close-btn" id="closeCartModal">&times;</span>
            <h2>Your Cart</h2>
            <ul class="cart-items" id="cartItemsModal">
                <!-- Cart items will be dynamically added here -->
            </ul>
            <p>Total: <span class="cart-item-total" id="cartTotalModal">$0.00</span></p>
            <button class="checkout-btn" id="checkoutBtnModal">Add Order</button>
        </div>
    </div>
    <!--Add to Cart Message-->
    <div id="custom-alert" style="text-align: center">
         <svg xmlns="http://www.w3.org/2000/svg" height="2em" viewBox="0 0 512 512" fill="#43c759">
             <!--<style>svg{fill:#43c759}</style>-->
            <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>
         </svg>

            <svg width="160" height="50" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="40" font-family="Arial" font-size="16" fill="#333" text-anchor="start">Item Added to Cart</text>
        </svg>

    </div>
     <!--Succesful Checkout Message-->
    <div id="custom-alert2" style="text-align: center">
         <svg xmlns="http://www.w3.org/2000/svg" height="2em" viewBox="0 0 512 512" fill="#43c759">
             <!--<style>svg{fill:#43c759}</style>-->
            <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>
         </svg>

            <svg width="160" height="50" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="40" font-family="Arial" font-size="16" fill="#333" text-anchor="start">Order Created!</text>
        </svg>

    </div>
    <!--No Items in the cart Message-->
    <div id="custom-alert1" style="text-align: center">
         <svg xmlns="http://www.w3.org/2000/svg" height="2em" viewBox="0 0 512 512" fill="#ff432e">
             <!--<style>svg{fill:#ff432e}</style>-->
             <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/>
         </svg>

            <svg width="160" height="50" xmlns="http://www.w3.org/2000/svg">
          <text x="10" y="40" font-family="Arial" font-size="16" fill="#333" text-anchor="start">No items in the Cart</text>
        </svg>

    </div>
    <!--<div id="custom-dialog" class="modal1">-->

    <!--</div>-->
    <script>
        var current_qty_modal = ""
        const searchParams = new URLSearchParams(window.location.search);
        var table = searchParams.get("table")
        document.getElementById("table").value = table
         var menuItems = []
            fetch(window.origin + "/api/method/restaurant.api.get_items")
                .then(response => {
                    return response.json()
                })
                .then(items => {
             menuItems = items.message
             const menuContainer = document.getElementById("menuContainer");
             const container = document.getElementsByClassName("container");
            const cart = document.getElementById("cart");
            const cartItems = document.getElementById("cartItems");
            const cartTotal = document.getElementById("cartTotal");
            const cartModal = document.getElementById("cartModal");
            const cartItemsModal = document.getElementById("cartItemsModal");
            const cartTotalModal = document.getElementById("cartTotalModal");
            const openCartBtn = document.getElementById("openCartBtn");
            const closeCartModal = document.getElementById("closeCartModal");
            const filterButtons = document.querySelectorAll(".filter-button");
            const searchInput = document.getElementById("searchInput");

            let cartContents = [];
            let currentCategory = "all";


        // Function to render the menu
            function renderMenu() {
            // Clear the existing menu
            menuContainer.innerHTML = "";

            // Filter and display menu items based on the selected category and search input
            menuItems.forEach((item, index) => {
                if (
                    (currentCategory === "all" || currentCategory === item.category) &&
                    (searchInput.value.trim() === "" || item.item_name.toLowerCase().includes(searchInput.value.trim().toLowerCase()))
                ) {
                    const menuItem = document.createElement("div");
                    menuItem.classList.add("menu-item");
                    console.log("INEDEEEE")
                    console.log(index)
                    menuItem.innerHTML = `
                        <img src="${item.image}" alt="${item.item_name}">
                        <div class="menu-item-content">

                            <h3>${item.item_name}</h3>
                            <p>${item.description}</p>
                            <div class="quantity-modal ${item.id}" >
                                <label for="pizzaQty">Quantity:</label>
                                <input type="number" id="${item.id}qty" name="qty" class="quantity-input" min="1" value="1" max="1000">
                                <button class="add-to-cart-button-after-qty" data-index="${index.toString()}" id="${item.id}">Add</button>
                            </div>
                            <p class="price">${item.price.toFixed(2)}</p>
                            <button class="add-to-cart-btn" id="${item.id}">Add to Cart</button>

                        </div>
                    `;

                    const addToCartButton = menuItem.querySelector(".add-to-cart-btn");
                    addToCartButton.addEventListener("click", addToCart);

                    const addToCartButtonAfterQty = menuItem.querySelector(".add-to-cart-button-after-qty");
                    addToCartButtonAfterQty.addEventListener("click", addToCartAfterQty);

                    const qtyInput = menuItem.querySelector(".quantity-input");
                    qtyInput.addEventListener("click", qty_change);

                    menuContainer.appendChild(menuItem);
                }
            });
        }
            var customDialog = document.createElement('div')
            customDialog.classList.add("modal1");
            customDialog.setAttribute("id","custom-dialog")
            customDialog.innerHTML = `<div class="modal-content1">
                <p>Are you sure you want to proceed?</p>
                <button class="modal-button1 confirm" >Yes</button>
                <button class="modal-button1 notconfirm">No</button>
            </div>`
            const confirmDeletion = customDialog.querySelector(".confirm");
            confirmDeletion.addEventListener("click", confirmAction);
             const notConfirmDeletion = customDialog.querySelector(".notconfirm");
            notConfirmDeletion.addEventListener("click", closeConfirmationDialog);
            container[0].append(customDialog)
        // Function to handle adding items to the cart
        function qty_change(event) {
            console.log(event.target    )
        }
            function addToCartAfterQty(event) {
                const button = event.target;
                const index = button.getAttribute("data-index");
                if (index !== null) {
                    const existingItem = cartContents.find((cartItem) => cartItem.id === menuItems[index].id);
                    if (existingItem) {
                        existingItem.qty += parseInt(document.getElementById(menuItems[index].id.toString() + "qty").value);
                        const current = document.getElementsByClassName(current_qty_modal)[0];
                        current.style.display = 'none';
                        document.getElementById(menuItems[index].id.toString() + "qty").value = 1
                        existingItem.amount = existingItem.qty * existingItem.price
                        var customAlert1 = document.getElementById('custom-alert');
                        customAlert1.style.display = 'block';
                        setTimeout(() => {
                            customAlert.style.display = 'none';
                        },3000)
                        renderCart();
                    } else {
                        menuItems[index]['qty'] = parseInt(document.getElementById(menuItems[index].id.toString() + "qty").value);
                        menuItems[index]['amount'] = menuItems[index].price * menuItems[index]['qty']
                        const current = document.getElementsByClassName(current_qty_modal)[0];
                        current.style.display = 'none';
                        document.getElementById(menuItems[index].id.toString() + "qty").value = 1
                        const selectedItem = menuItems[index];
                        cartContents.push(selectedItem);
                        var customAlert = document.getElementById('custom-alert');
                        customAlert.style.display = 'block';
                        setTimeout(() => {
                            customAlert.style.display = 'none';
                        },3000)
                        renderCart();
                    }

                }
            }
            function addToCart(event) {
                if(current_qty_modal){
                     const current = document.getElementsByClassName(current_qty_modal)[0];
                    current.style.display = 'none';
                }
                const modal = document.getElementsByClassName(event.target.id)[0];
                console.log(modal)
                modal.style.display = 'block';
                current_qty_modal = event.target.id
//            const button = event.target;
//            const index = button.getAttribute("data-index");
//            if (index !== null) {
//                const existingItem = cartContents.find((cartItem) => cartItem.id === menuItems[index].id);
//                if (existingItem) {
//                    existingItem.qty++;
//                    var customAlert1 = document.getElementById('custom-alert');
//                    customAlert1.style.display = 'block';
//                    setTimeout(() => {
//                        customAlert.style.display = 'none';
//                    },3000)
//                    renderCart();
//                } else {
//                    menuItems[index]['qty'] = 1
//                    const selectedItem = menuItems[index];
//                    cartContents.push(selectedItem);
//                    var customAlert = document.getElementById('custom-alert');
//                    customAlert.style.display = 'block';
//                    setTimeout(() => {
//                        customAlert.style.display = 'none';
//                    },3000)
//                    renderCart();
//                }
//
//            }
        }
         function closeConfirmationDialog() {
            customDialog.style.display = 'none';
        }

        function confirmAction(event) {
                var cartItemModal = document.getElementsByClassName(event.target.id)[1]
                const index = cartContents.findIndex((cartItem) => cartItem.id === event.target.id);
                cartContents.splice(index, 1);
                cartItemsModal.removeChild(cartItemModal);
                closeConfirmationDialog();
                if(cartContents.length === 0){
                    closeCartModal.click()
                }
        }
        // Function to render the cart
         function incrementQuantity(event) {
             var eventId = event.target.id
             var inputId = eventId.split("_")[0]
             console.log(event.target)
             console.log(inputId)
            var index = cartContents.find((cartItem) => cartItem.id === inputId);
             console.log(index)
             index.qty += 1
             index.amount = index.price * index.qty
//            const quantityInput = document.getElementById(inputId);
//            quantityInput.value = parseInt(quantityInput.value) + 1;
            renderCart()
        }

        // JavaScript for decrementing the quantity
        function decrementQuantity(event) {
              var eventId = event.target.id
             var inputId = eventId.split("_")[0]
            var index = cartContents.find((cartItem) => cartItem.id === inputId);
            index.qty -= 1
            index.amount = index.price * index.qty
            if(index.qty === 0){
                index.qty += 1
                const customDialog = document.getElementById('custom-dialog');
                customDialog.style.display = 'flex';
                const confirmDialogId = document.getElementsByClassName("confirm")[0];
                confirmDialogId.id = index.id
            }
             renderCart()
        }
            function renderCart() {
            cartItems.innerHTML = "";
            cartItemsModal.innerHTML = "";
            let total = 0;
            const cartItem1 = document.createElement("li");
                cartItem1.classList.add("cart-item");

                cartItem1.innerHTML = `
                    <span class="cart-item-name" style="width:20%">Item</span>
                    <span style="width:20%">Qty</span>
                    <span style="width:20%">Price</span>
                    <span style="width:20%">Amount</span>
                    <span style="width:20%">Actions</span>
                `;

                cartItems.appendChild(cartItem1);

                const cartItemModal1 = document.createElement("li");
                cartItemModal1.classList.add("cart-item");

                cartItemModal1.innerHTML = `
                    <span class="cart-item-name" style="width:20%">Item</span>
                    <span style="width:20%">Qty</span>
                    <span style="width:20%">Price</span>
                    <span style="width:20%">Amount</span>
                    <span style="width:20%">Actions</span>
                `;

                cartItemsModal.appendChild(cartItemModal1);

            cartContents.forEach((item, index) => {
                const cartItemModal = document.createElement("li");
                cartItemModal.classList.add("cart-item");
                cartItemModal.classList.add(item.id);
                cartItemModal.innerHTML = `
                    <span class="cart-item-name" style="width:20%">${item.item_name}</span>

                    <span style="width:20%">
                    <span style="margin-right:4%" class="quantity-arrows decrement">

                        <svg  id="${item.id}_increment" width="20px" height="20px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" fill="#a80000">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier"> <title>minus-circle</title><desc>Created with Sketch Beta.</desc> <defs> </defs>
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"> <g id="Icon-Set-Filled" sketch:type="MSLayerGroup" transform="translate(-518.000000, -1089.000000)" fill="#a80000"><path id="${item.id}_increment"  d="M540,1106 L528,1106 C527.447,1106 527,1105.55 527,1105 C527,1104.45 527.447,1104 528,1104 L540,1104 C540.553,1104 541,1104.45 541,1105 C541,1105.55 540.553,1106 540,1106 L540,1106 Z M534,1089 C525.163,1089 518,1096.16 518,1105 C518,1113.84 525.163,1121 534,1121 C542.837,1121 550,1113.84 550,1105 C550,1096.16 542.837,1089 534,1089 L534,1089 Z" sketch:type="MSShapeGroup"> </path> </g> </g> </g></svg>
                    </span>
                        ${item.qty}
                    <span  style="margin-left:4%"  class="quantity-arrows increment"  >
                       <svg  id="${item.id}_increment" width="20px" height="20px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" fill="#11ff00" stroke="#11ff00">
                       <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                       <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                       <g id="SVGRepo_iconCarrier"> <title>plus-circle</title>
                       <desc>Created with Sketch Beta.</desc> <defs> </defs>
                       <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                       <g id="Icon-Set-Filled" sketch:type="MSLayerGroup" transform="translate(-466.000000, -1089.000000)" fill="#098a00">
                       <path  id="${item.id}_decrement" d="M488,1106 L483,1106 L483,1111 C483,1111.55 482.553,1112 482,1112 C481.447,1112 481,1111.55 481,1111 L481,1106 L476,1106 C475.447,1106 475,1105.55 475,1105 C475,1104.45 475.447,1104 476,1104 L481,1104 L481,1099 C481,1098.45 481.447,1098 482,1098 C482.553,1098 483,1098.45 483,1099 L483,1104 L488,1104 C488.553,1104 489,1104.45 489,1105 C489,1105.55 488.553,1106 488,1106 L488,1106 Z M482,1089 C473.163,1089 466,1096.16 466,1105 C466,1113.84 473.163,1121 482,1121 C490.837,1121 498,1113.84 498,1105 C498,1096.16 490.837,1089 482,1089 L482,1089 Z" sketch:type="MSShapeGroup"> </path> </g> </g> </g></svg>
                   </span>
                    </span>

                    <span style="width:20%">${item.price.toFixed(2)}</span>
                    <span style="width:20%">${item.amount.toFixed(2)}</span>
                    <span style="width:20%">

                      <svg class="remove-from-cart"  fill="#ff0000" width="30px" height="30px" viewBox="0 0 200 200" data-name="Layer 1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" stroke="#ff0000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><title></title><path d="M100,15a85,85,0,1,0,85,85A84.93,84.93,0,0,0,100,15Zm0,150a65,65,0,1,1,65-65A64.87,64.87,0,0,1,100,165Z"></path><path d="M128.5,74a9.67,9.67,0,0,0-14,0L100,88.5l-14-14a9.9,9.9,0,0,0-14,14l14,14-14,14a9.9,9.9,0,0,0,14,14l14-14,14,14a9.9,9.9,0,0,0,14-14l-14-14,14-14A10.77,10.77,0,0,0,128.5,74Z"></path></g></svg>
                      </span>
                `;
                const increment = cartItemModal.querySelector(".increment");
                console.log(increment)
                increment.addEventListener("click", incrementQuantity);
                const decrement = cartItemModal.querySelector(".decrement");
                decrement.addEventListener("click", decrementQuantity);

                const removeButton = cartItemModal.querySelector('.remove-from-cart');
                removeButton.addEventListener('click', (r) => {
                    const customDialog = document.getElementById('custom-dialog');
                    customDialog.style.display = 'flex';
                    const confirmDialogId = document.getElementsByClassName("confirm")[0];
                    console.log(confirmDialogId)
                    confirmDialogId.id = item.id

//                    const index = cartContents.findIndex((cartItem) => cartItem.id === r.id);
//                    cartContents.splice(index, 1);
//                    cartItemsModal.removeChild(cartItemModal);
//                    if(cartContents.length === 0){
//                        closeCartModal.click()
//                    }
                });
                cartItemsModal.appendChild(cartItemModal);

                total += item.amount;
            });
            cartTotal.textContent = total.toFixed(2);
            cartTotalModal.textContent = total.toFixed(2);

            // Enable or disable checkout button based on cart contents
            const checkoutBtn = document.getElementById("checkoutBtn");
            const checkoutBtnModal = document.getElementById("checkoutBtnModal");

            checkoutBtn.disabled = cartContents.length === 0;
            checkoutBtnModal.disabled = cartContents.length === 0;
        }

        // Event listener for the checkout button
            const checkoutBtn = document.getElementById("checkoutBtn");
            const checkoutBtnModal = document.getElementById("checkoutBtnModal");


        checkoutBtnModal.addEventListener("click", () => {
            // In a real application, you would handle the payment processing here
        const apiUrl = window.origin + '/api/method/restaurant.api.add_order'; // Replace with your app's details

        const requestData = {
            table: table,
            items: cartContents
        }
        var request_obj = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'Access-Control-Allow-Origin': '*',


            },
            body: JSON.stringify(requestData),
            mode: 'no-cors',
            cache: "reload"

        }
        console.log(request_obj)
        fetch(apiUrl, request_obj)
        .then(response => {
            console.log(response)
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json(); // Parse the response body as JSON
        })
        .then(data => {
            cartContents = [];
            renderCart();
            closeCartModal.click()
             var customAlert = document.getElementById('custom-alert2');
                    customAlert.style.display = 'block';
                    setTimeout(() => {
                        customAlert.style.display = 'none';
                    },3000)

        })
        .catch(error => {
            // Handle any errors that occurred during the fetch
            console.error('Error:', error);
        });

//            alert("Payment successful! Your order has been placed.");
//            cartContents = [];
//            renderCart();
//            closeCartModal.click(); // Close the modal
        });

        // Event listeners for category filtering
        filterButtons.forEach(button => {
            button.addEventListener("click", () => {
                currentCategory = button.getAttribute("data-category");
                renderMenu();
            });
        });

        // Event listener for search input
        searchInput.addEventListener("input", () => {
            renderMenu();
        });

        // Event listener for opening the cart modal
        openCartBtn.addEventListener("click", () => {
            if(cartContents.length > 0){
                cartModal.style.display = "block";
            } else {
                 var customAlert = document.getElementById('custom-alert1');
                    customAlert.style.display = 'block';
                    setTimeout(() => {
                        customAlert.style.display = 'none';
                    },3000)

            }
        });

        // Event listener for closing the cart modal
        closeCartModal.addEventListener("click", () => {
            cartModal.style.display = "none";
        });

        // Initialize the menu and cart
        renderMenu();
        renderCart();

            })
    </script>
</body>
</html>
